/*
 *  Last modified time :2018-1-8
 */
function jumpFactive(f,c){if(!c){var e=f.parent("li").data("itemid");var d=f.attr("href");var b=f.children("span").text()}else{var e=f.itemid||"";var d=f.itemurl;var b=f.itemtext}var a=true;if(d==""||d=="#"){if(c?$("#side-menu li a[data-itemid="+e+"]").next().is("ul"):f.next().is("ul")){return}d=COM_TOOLS._404Page}$("#side-menu li a").removeClass("x-highlight");$("#side-menu li a[data-itemid="+e+"]").addClass("x-highlight");$("#t_tabBox li>a").each(function(){var g=$(this).parent();if($(this).data("itemid")==e){if(!g.hasClass("active")){$("#t_tabBox li a[data-itemid="+e+"]").tab("show");COM_TOOLS._view.tabScrollFn.scrollToTab(g)}a=false;return false}});if(a){if($("#t_tabBox li").length>COM_TOOLS._tabSingle){$("#t_tabBox>li:last").remove();$("#tab_contBox>div:last").remove()}create_tab_iframe(e,d,b);$("#t_tabBox>li:last a").tab("show");COM_TOOLS._view.tabScrollFn.scrollToTab($("#t_tabBox > li:last"))}}function jumpFone(e,b){if(!b){var d=e.parent("li").data("itemid");var c=e.attr("href");var a=e.children("span").text()}else{var d=e.itemid;var c=e.itemurl;var a=e.itemtext}if(c==""||c=="#"){if(b?$("#side-menu li a[data-itemid="+d+"]").next().is("ul"):e.next().is("ul")){return}c=COM_TOOLS._404Page}$("#side-menu li a").removeClass("x-highlight");$("#side-menu li a[data-itemid="+d+"]").addClass("x-highlight");if($("#t_tabBox li").length<2){create_tab_iframe()}$("#tabOne iframe").attr("src",c);$("#t_tabBox li a[href=#tabOne]").text(a).tab("show")}function create_tab_iframe(e,b,a){var d='<li role="presentation"><a href="#tab'+(e||"One")+'" aria-controls="tab'+(e||"One")+'" role="tab" data-toggle="tab" '+(e&&('data-itemid="'+e+'"'))+">"+(a||"")+'<i class="fa fa-times-circle"></i></a></i></li>';var c='<div id="tab'+(e||"One")+'" role="tabpanel" class="tab-pane"><iframe class="js-iframe-comwin" width="100%" height="100%" frameborder="0"  '+(b&&('src="'+b+'"'))+' name="mainPiframe'+(e||"One")+'" allowtransparency="yes"></iframe></div>';$("#t_tabBox").append(d);$("#tab_contBox").append(c)}function closeTab(){var c=$(this).parent().data("itemid");var b=$(this).parent().width();var a=$(this).closest("li");if($(this).closest("li").hasClass("active")){if(a.next("li").size()){a.next().children("a").tab("show");a.remove();$("#tab_contBox #tab"+c).remove()}else{if(a.prev("li").size()){a.prev().children("a").tab("show");a.remove();$("#tab_contBox #tab"+c).remove()}}}else{a.remove();$("#tab_contBox #tab"+c).remove()}COM_TOOLS._view.tabScrollFn.scrollToTab("#t_tabBox > li.active")}function activeTabs(b,a){if($("body").hasClass("mini-navbar")&&!a){return false}if(b.attr("href")&&b.attr("href")!="#"&&b.attr("target")=="_blank"){window.open(b.attr("href"))}else{if(COM_TOOLS._tabSingle>1){setTimeout(function(){jumpFactive(b)},300)}else{setTimeout(function(){jumpFone(b)},300)}}}function getPermission(){$.ajax({type:"get",url:"",cache:false,dataType:"json",success:function(a){if(a&&a.result==1){if(COM_TOOLS.sessionStorageSupport()){COM_TOOLS.save_toSession("TEDU-checkbtn",JSON.stringify(a.crmCodes))}else{COM_TOOLS.alert(TEDU_MESSAGE.get("checkWinVer"))}}else{COM_TOOLS.alert(TEDU_MESSAGE.get("noGetPermission"))}},error:function(){COM_TOOLS.alert(TEDU_MESSAGE.get("networkError"))}})}$(document).ready(function(){window.onbeforeunload=function(){return"您确定要离开本窗口吗？"};$("#dropdown_indexmenux").tooltip({container:"body",selector:".js-indexmenu-tips",trigger:"hover",placement:"left",template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner" style="max-width: 300px;"></div></div>'});if(COM_TOOLS._isOpenSwitch){$("#switch-checkbox").parent().removeClass("hidden")}if(isNaN(COM_TOOLS._tabSingle)||COM_TOOLS._tabSingle<1){COM_TOOLS._tabSingle=1}$(".navbar-minimalize").click(function(){if($("body").hasClass("mini-navbar")){$("body").removeClass("mini-navbar");$("#side-menu").removeAttr("style").metisMenu()}else{$("body").addClass("mini-navbar");$("#side-menu").metisMenu("dispose").hide();setTimeout(function(){$("#side-menu").fadeIn(400)},200)}});$(window).bind("load resize",function(){if($(this).width()<993){$("body").addClass("mini-navbar")}else{$("body").removeClass("mini-navbar")}});COM_TOOLS._tabSingle>1&&$("#tab_header_x").addClass("metistabs");$("#side-menu li a").bind("click",function(d,c){d.preventDefault();activeTabs($(this))});$("#t_tabBox").on("click","li>a>i",closeTab);$(".tabs-close-all-btn").click(function(){$("#t_tabBox li>a>i").trigger("click")});$("#side-menu").metisMenu();$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(c){var d=$(this).data("itemid");$("#side-menu li a").removeClass("x-highlight");$("#side-menu li[data-itemid="+d+"]>a").addClass("x-highlight")});$(".sidebar-collapse").mCustomScrollbar({axis:"xy",scrollbarPosition:"outside",theme:"light-2",advanced:{}});$(".minibar-menu").mCustomScrollbar({scrollbarPosition:"outside",theme:"light-2"});var b=null;$(document).on("mouseenter",".mini-navbar #side-menu li",function(){if(b){window.clearTimeout(b)}$("#minibar_menu").html("");var f=$(this).position().top;var g=-($(this).closest(".mCSB_container").position().top);var d=$(window).height()-(f+60-g);var e=$(this).prop("outerHTML");$("#minibar_menu").html('<ul class="block-menu nav">'+e+"</ul>");$("#minibar_menu .block-menu>li").removeClass("active");$("#minibar_menu .block-menu>li>a>.fa.arrow").remove();if($("#minibar_menu .block-menu>li>ul").length>0){$("#minibar_menu .block-menu>li>ul").metisMenu()}if($(".minibar-menu").height()<d){$(".minibar-menu").removeAttr("style").css({top:(f+60-g)})}else{var c=d<50?0:d-50;$(".minibar-menu").removeAttr("style").css({bottom:c})}$(".minibar-menu").show()});$(document).on("click","#minibar_menu .block-menu>li a",function(c){c.preventDefault();activeTabs($(this),true);if($(this).next("ul.nav").length==0){$(".minibar-menu").hide();$("#minibar_menu").html("")}});$(document).on("mouseenter",".minibar-menu",function(){if(b){window.clearTimeout(b)}});$(document).on("mouseleave",".mini-navbar #side-menu li, .minibar-menu",function(c){b=window.setTimeout(function(){$(".minibar-menu").hide();$("#minibar_menu").html("")},200)});$(".custem_select_mod > .dropdown-menu a").click(function(){var d=$(this);var e=d.closest(".custem_select_mod");var c=e.find(".cus_selval");c.text($.trim(d.text())).data("itemval",d.data("itemval"));(typeof e.data("callback")=="function")&&(e.data("callback"))(d,e,c)});$(".custem_select_mod").each(function(c,d){$(this).find("a:eq(0)").trigger("click")});if(COM_TOOLS._customMenus>0){window.setTimeout(function(){if(!cusMenu_initData){cusMenu_initData=[]}var f=["btn-primary","btn-success","btn-info","btn-warning","btn-danger"];var c=j("#side-menu",0);$(".shortcut-menu-open").removeClass("shortcut-menu-open");function j(m,l){var n=[];var o=(typeof m=="string"?$(m):m);o.children("li").each(function(q,t){var s=$(this);var r=s.children("a");var p=r.next("ul");n.push({id:"cus_m_"+s.data("itemid"),parent:(typeof l=="number"?0:"cus_m_"+l.data("itemid")),text:$.trim(r.text()),icon:r.children("i").first().attr("class")});if(p.length>0){$.merge(n,j(p,s))}});return n}function i(m){var l=[];$.each(m,function(o,p){l.push('<li data-itemid="',p.id,'"><a class="btn ',p.color,'" data-toggle="tooltip" data-placement="bottom" data-original-title="',p.tit,'"><i class="',p.icon,'"></i></a></li>')});$("#cumBopbarMenu").html(l.join(""))}$("#cumBopbarMenu").tooltip({selector:"li>a",trigger:"hover"});function e(){var l=[];$.each(cusMenu_initData,function(m,o){$.each(c,function(p,n){if(n.id.replace("cus_m_","")==o){l.push({id:o,icon:n.icon,tit:n.text,color:f[(m%5)]});return false}})});return l}i(e());var d=0;$("#carousel-bianji .btn-box-shortcut").mCustomScrollbar({theme:"dark-3"});var g=$(".tree-menu-box").mCustomScrollbar({theme:"dark-3"});$("#menu_search_input,#menu_search_btn").keypress(function(){$("#tree_box_menu").jstree(true).search($(this).val());g.mCustomScrollbar("scrollTo",".jstree-search")});$("#menu_search_btn").click(function(){$("#tree_box_menu").jstree(true).search($("#menu_search_input").val());g.mCustomScrollbar("scrollTo",".jstree-search")});$("#carousel-bianji").on("click",".btn-box-shortcut button",function(){var l=$(this).data("itemid");var m=$("#tree_box_menu").jstree(true);$(this).parent().remove();m.uncheck_node("cus_m_"+l)}).on("click","#r_shortcut_menu",function(){var l=$("#tree_box_menu").jstree(true);$("#carousel-bianji .btn-box-shortcut .mCSB_container").html("");l.deselect_all();d=0}).on("click","#save_shortcut_menu",function(n,o){var l=[],m=[];$("#carousel-bianji .btn-box-shortcut .mCSB_container button").each(function(){var p=$(this).data("itemid");l.push({id:p,icon:$(this).data("icon_"),tit:$(this).next().text(),color:$(this).data("color_")});m.push(p)});saveCusMenuData&&saveCusMenuData(m,function(){cusMenu_initData=m;i(l);layer.close(h)})});var k=$("#index_cus_menus"),h=0;$("#customMenu_btn").click(function(){COM_TOOLS.requireJsFn(["jstree"],[],function(){var n=$("#tree_box_menu").jstree(true);if(!n){$("#tree_box_menu").jstree({checkbox:{three_state:false},core:{data:c,themes:{dots:false}},plugins:["checkbox","search"]}).on("changed.jstree",function(s,t){var p=$(this).jstree(true);if(t.action=="deselect_all"){return}var w=t.node.id;var r=p.get_text(w);var o=$.trim(p.get_text(w)),v=w.replace("cus_m_",""),u=t.node.icon;if(p.is_selected(w)){if($("#carousel-bianji>.btn-box-shortcut .mCSB_container button.cuschecked").length>(COM_TOOLS._customMenus-1)){p.deselect_node(w);COM_TOOLS.alert(TEDU_MESSAGE.get("platform.common.msg.choose_max",[COM_TOOLS._customMenus]));return false}var q=(f[(d%5)]);$("#carousel-bianji>.btn-box-shortcut .mCSB_container").append('<div class="col-xs-4 text-center"><button data-color_="'+q+'" data-icon_="'+u+'" data-itemid="'+v+'" type="button" class="btn btn-circle btn-lg cuschecked '+q+'"><em><i class="glyphicon glyphicon-minus"></i></em><i class="'+u+'"></i></button><p>'+o+"</p></div>");d++}else{$("#carousel-bianji button[data-itemid="+v+"]").parent().remove()}}).on("ready.jstree",function(){var p=$(this).jstree(true);var o=[];$.each(cusMenu_initData,function(q,r){o.push("cus_m_"+r)});p.select_node(o,false,false)});n=$("#tree_box_menu").jstree(true)}$("#carousel-bianji .btn-box-shortcut .mCSB_container").html("");n.deselect_all();d=0;var l=cusMenu_initData;if(l){var m=[];$.each(l,function(o,p){m.push("cus_m_"+p)});n.select_node(m,false,false)}h=cumParentWinModal(TEDU_MESSAGE.get("platform.common.msg.zdy_menu"),k,{type:1,area:["770px","430px"]})})});$("#cumBopbarMenu").on("click","li>a",function(){var l=$(this).parent().data("itemid");$("#side-menu li[data-itemid="+l+"]>a").trigger("click")})},1500)}$("#welPiframe").load(function(){$(this).contents().find("body").on("click","a.cus-evt-link",function(d){var c={};c.itemid=$(this).data("itemid")||"";c.itemtext=$.trim($(this).text());c.itemurl=$(this).attr("href");if(c.itemid){d.preventDefault();if(COM_TOOLS._tabSingle>1){setTimeout(function(){jumpFactive(c,true)},300)}else{setTimeout(function(){jumpFone(c,true)},300)}}})});function a(){var d=null;function c(){if(d){d.abort()}d=$.ajax({type:"get",url:"/getusermsg/api",async:true,cache:false,timeout:3000,dataType:"json",success:function(e){if(e&&e.code==1){$.each(e.list,function(g,h){var f=[];f.push("<h3>",h.title,"</h3>");f.push('<div class="ind-msg-cont">',h.brief,"</div>");cumCurWinModal(TEDU_MESSAGE.get("platform.common.msg.message_notice"),f.join(""),top,{type:1,other:{offset:"rb",cusOffsetLeft:-10,shade:0,skin:"layui-skin-msg",move:false},area:["280px","180px"]})})}},complete:function(){window.setTimeout(function(){c()},COM_TOOLS._isOpenNotice.requestTime*1000)}})}c()}});